/*
 * geomag.h
 *
 *  Created on: Aug 12, 2014
 Author: mobintu
 */
#ifndef GEOMAG_H_
#define GEOMAG_H_

#include "stm32f4xx_hal.h"
#include <math.h> /* change to arm_math.h */

typedef struct
{
  double sdate;
  double latitude;
  double longitude;
  double alt;
  double Xm;
  double Ym;
  double Zm;
  double decl;
  double incl;
  double h;
  double f;
} geomagStruct;

typedef struct
{
  int year;
  int month;
  int day;
  double UT;
  double decyear;
} gTime;

int
geomag (geomagStruct *gStr);
void
JD2Greg (double JD, gTime *t);
double
Greg2JD (gTime t);
double
decyear (gTime t);
void
NED2ECEF (geomagStruct *gStr);

double
degrees_to_decimal (int degrees, int minutes, int seconds);
double
julday (int month, int day, int year);
int
interpsh (double date, double dte1, int nmax1, double dte2, int nmax2, int gh);
int
extrapsh (double date, double dte1, int nmax1, int nmax2, int gh);
int
shval3 (int igdgc, double flat, double flon, double elev, int nmax, int gh,
	int iext, double ext1, double ext2, double ext3);
int
dihf (int gh);
int
safegets (char *buffer, int n);
int
getshc (int iflag, int nmax_of_gh, int gh);

static float COEFF1[] =
  { -29442.00, -1501.00, -2445.10, 3012.90, 1676.70, 1350.70, -2352.30, 1225.60,
      582.00, 907.60, 813.70, 120.40, -334.90, 70.40, -232.60, 360.10, 192.40,
      -140.90, -157.50, 4.10, 70.00, 67.70, 72.70, -129.90, -28.90, 13.20,
      -70.90, 81.60, -76.10, -6.80, 51.80, 15.00, 9.40, -2.80, 6.80, 24.20,
      8.80, -16.90, -3.20, -20.60, 13.40, 11.70, -15.90, -2.00, 5.40, 8.80,
      3.10, -3.30, 0.70, -13.30, -0.10, 8.70, -9.10, -10.50, -1.90, -6.30, 0.10,
      0.50, -0.50, 1.80, -0.70, 2.10, 2.40, -1.80, -3.60, 3.10, -1.50, -2.30,
      2.00, -0.80, 0.60, -0.70, 0.20, 1.70, -0.20, 0.40, 3.50, -1.90, -0.20,
      0.40, 1.20, -0.80, 0.90, 0.10, 0.50, -0.30, -0.40, 0.20, -0.90, 0.00,
      0.00, -0.90, 0.40, 0.50, -0.50, 1.00, -0.20, 0.80, -0.10, 0.30, 0.10,
      0.50, -0.40, -0.30 };

static float COEFF2[] =
  { 0.00, 4797.10, 0.00, -2845.60, -641.90, 0.00, -115.30, 244.90, -538.40,
      0.00, 283.30, -188.70, 180.90, -329.50, 0.00, 47.30, 197.00, -119.30,
      16.00, 100.20, 0.00, -20.80, 33.20, 58.90, -66.70, 7.30, 62.60, 0.00,
      -54.10, -19.50, 5.70, 24.40, 3.40, -27.40, -2.20, 0.00, 10.10, -18.30,
      13.30, -14.60, 16.20, 5.70, -9.10, 2.10, 0.00, -21.60, 10.80, 11.80,
      -6.80, -6.90, 7.80, 1.00, -4.00, 8.40, 0.00, 3.20, -0.40, 4.60, 4.40,
      -7.90, -0.60, -4.20, -2.80, -1.20, -8.70, 0.00, -0.10, 2.00, -0.70, -1.10,
      0.80, -0.20, -2.20, -1.40, -2.50, -2.00, -2.40, 0.00, -1.10, 0.40, 1.90,
      -2.20, 0.30, 0.70, -0.10, 0.30, 0.20, -0.90, -0.10, 0.70, 0.00, -0.90,
      0.40, 1.60, -0.50, -1.20, -0.10, 0.40, -0.10, 0.40, 0.50, -0.30, -0.40,
      -0.80 };

static float COEFF3[] =
  { 10.30, 18.10, -8.70, -3.30, 2.10, 3.40, -5.50, -0.70, -10.10, -0.70, 0.20,
      -9.10, 4.10, -4.30, -0.20, 0.50, -1.30, -0.10, 1.40, 3.90, -0.30, -0.10,
      -0.70, 2.10, -1.20, 0.30, 1.60, 0.30, -0.20, -0.50, 1.30, 0.10, -0.60,
      -0.80, 0.20, 0.20, 0.00, -0.60, 0.50, -0.20, 0.40, 0.10, -0.40, 0.30,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00 };

static float COEFF4[] =
  { 0.00, -26.60, 0.00, -27.40, -14.10, 0.00, 8.20, -0.40, 1.80, 0.00, -1.30,
      5.30, 2.90, -5.20, 0.00, 0.60, 1.70, -1.20, 3.40, 0.00, 0.00, 0.00, -2.10,
      -0.70, 0.20, 0.90, 1.00, 0.00, 0.80, 0.40, -0.20, -0.30, -0.60, 0.10,
      -0.20, 0.00, -0.30, 0.30, 0.10, 0.50, -0.20, -0.30, 0.30, 0.00, 0.00,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00,
      0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00, 0.00 };

#endif /* GEOMAG_H_ */
